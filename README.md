# xv6-reading
Record of XV6 Reading

## Operating System organization

#### 物理资源的抽象

由于应用程序可能存在各式各样的Bug，为了避免一个应用的失败影响其他应用，操作系统应该提供**隔离性**。操作系统还实现了不同进程间的切换，使得不同应用可以**时分共享CPU硬件**。系统调用接口为应用程序提供了极大的便利性，同时保证硬件资源相对高效和安全的使用。

#### 不同模式下的权利

RISC-V提供了三种指令执行模式，以便从硬件层面为操作系统提供帮助。

* machine mode
* supervisor mode
* user mode

机器模式下可以执行任意指令，该模式通常用于配置电脑。电脑启动后会很快转到监管模式，该模式运行机器执行**特权指令**，如中断/读写页表寄存器等。应用程序处于用户模式，不允许执行特权指令。一个应用程序希望触发内核函数，例如risc-v通过`ecall`指令进行。


#### 内核结构组织


* 宏内核
* 微内核


#### 进程 Overview

xv6中实现隔离的单元是进程(Process)，进程间无法相互破坏，而且进程也不会破坏内核程序。

每个进程维护了两个栈(Stack)，一个用户栈，另一个内核栈。当运行在用户空间时使用用户栈，陷入内核执行时则使用内核栈。

`ecall` 指令提升硬件特权级别，将PC指向内核定义的入口点，在此处进行内核栈和内核指令的执行，实现系统调用。

`sret` 指令切换回用户空间和用户栈，并且降低硬件的特权级别。

`mret` 指令返回之间的调用从监督模式到机器模式


RISC-V 中栈是向下生长的，即栈初始为高地址，逐步向低地址延伸。
